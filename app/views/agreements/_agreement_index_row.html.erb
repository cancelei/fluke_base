<% presenter = present(agreement) %>
<tr id="<%= dom_id(agreement) %>"
    class="group hover:bg-base-200 transition-colors cursor-pointer"
    onclick="if(event.target.tagName !== 'A' && event.target.tagName !== 'BUTTON' && !event.target.closest('a, button')) { Turbo.visit(<%= agreement_path(agreement).to_json %>); }">
  <td class="px-2 py-3 whitespace-nowrap truncate">
    <div class="font-medium group-hover:text-primary transition-colors">
      <% if agreement.active? || agreement.completed? %>
        <%= present(agreement.project).display_name(current_user) %>
      <% elsif agreement.initiator&.id == current_user.id %>
        <%= present(agreement.project).display_name(current_user) %>
      <% else %>
        <span class="text-base-content/60"><%= present(agreement.project).display_name(current_user) %></span>
        <span class="text-xs text-base-content/40">(limited access)</span>
      <% end %>
    </div>
  </td>
  <td class="px-2 py-3 whitespace-nowrap">
    <div class="flex items-center gap-1 flex-wrap">
      <%= presenter.agreement_type_badge %>
      <% if agreement.initiator&.id == current_user.id %>
        <%= presenter.payment_type_badge %>
      <% end %>
    </div>
  </td>
  <td class="px-2 py-3 whitespace-nowrap truncate max-w-xs">
    <% is_initiator = agreement.initiator&.id == current_user.id %>
    <% the_other_party = is_initiator ? agreement.other_party : agreement.initiator %>
    <% if the_other_party %>
      <%= link_to person_path(the_other_party), onclick: "event.stopPropagation();", class: "flex items-center gap-2 hover:text-primary transition-colors" do %>
        <%= render Ui::AvatarComponent.new(user: the_other_party, size: :xs, placeholder: :initials) %>
        <span class="text-sm font-medium truncate max-w-[100px]"><%= the_other_party.full_name %></span>
      <% end %>
    <% else %>
      <span class="text-sm text-base-content/60">No other party</span>
    <% end %>
  </td>
  <td class="px-2 py-3 whitespace-nowrap">
    <%= render "agreement_status", agreement: agreement %>
  </td>
  <td class="px-2 py-3 whitespace-nowrap">
    <% if agreement.initiator&.id == current_user.id %>
      <span class="text-sm text-base-content/60"><%= presenter.created_timeframe_simple %></span>
    <% else %>
      <%= presenter.payment_type_badge %>
    <% end %>
  </td>
  <td class="px-2 py-3 whitespace-nowrap text-right text-sm">
    <span class="font-medium"><%= presenter.time_remaining %></span>
  </td>
  <td class="px-2 py-3 whitespace-nowrap text-right">
    <%= render "agreement_actions", agreement: agreement %>
  </td>
</tr>
