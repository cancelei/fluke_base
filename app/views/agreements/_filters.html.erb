<%= turbo_frame_tag "agreement_filters", class: "block" do %>
  <div class="card bg-base-100 shadow-sm mb-8">
    <div class="card-body">
      <% if @query.active_filters? %>
          <div class="flex items-center space-x-2">
            <span class="badge badge-primary badge-sm">
              <%= @query.active_filters_count %> filter<%= "s" if @query.active_filters_count > 1 %> active
            </span>
            <%= link_to agreements_path,
                class: "btn btn-ghost btn-sm",
                data: { turbo_method: :get } do %>
              Clear all filters
            <% end %>
          </div>
        <% end %>

      <%= form_with url: agreements_path, method: :get, local: false,
          class: "mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6" do |form| %>

        <!-- Status Filter -->
        <div class="sm:col-span-2">
          <%= form.label :status, "Status", class: "label label-text" %>
          <%= form.select :status,
              options_for_select(AgreementsQuery.status_options, params[:status]),
              {},
              { class: "select select-bordered w-full",
                onchange: "this.form.requestSubmit();" } %>
        </div>

        <!-- Agreement Type Filter -->
        <div class="sm:col-span-2">
          <%= form.label :agreement_type, "Type", class: "label label-text" %>
          <%= form.select :agreement_type,
              options_for_select(AgreementsQuery.agreement_type_options, params[:agreement_type]),
              {},
              { class: "select select-bordered w-full",
                onchange: "this.form.requestSubmit();" } %>
        </div>

        <!-- Search Filter -->
        <div class="sm:col-span-2">
          <%= form.label :search, "Search", class: "label label-text" %>
          <%= form.text_field :search,
              placeholder: "Project name or participant...",
              value: params[:search],
              class: "input input-bordered w-full",
              oninput: "clearTimeout(this.searchTimeout); this.searchTimeout = setTimeout(() => this.form.requestSubmit(), 500);" %>
        </div>

        <!-- Start Date Range -->
        <div class="sm:col-span-3">
          <fieldset>
            <legend class="label label-text">Start Date Range</legend>
            <div class="mt-1 grid grid-cols-2 gap-2">
              <%= form.date_field :start_date_from,
                  placeholder: "From",
                  value: params[:start_date_from],
                  class: "input input-bordered w-full",
                  onchange: "this.form.requestSubmit();" %>
              <%= form.date_field :start_date_to,
                  placeholder: "To",
                  value: params[:start_date_to],
                  class: "input input-bordered w-full",
                  onchange: "this.form.requestSubmit();" %>
            </div>
          </fieldset>
        </div>

        <!-- End Date Range -->
        <div class="sm:col-span-3">
          <fieldset>
            <legend class="label label-text">End Date Range</legend>
            <div class="mt-1 grid grid-cols-2 gap-2">
              <%= form.date_field :end_date_from,
                  placeholder: "From",
                  value: params[:end_date_from],
                  class: "input input-bordered w-full",
                  onchange: "this.form.requestSubmit();" %>
              <%= form.date_field :end_date_to,
                  placeholder: "To",
                  value: params[:end_date_to],
                  class: "input input-bordered w-full",
                  onchange: "this.form.requestSubmit();" %>
            </div>
          </fieldset>
        </div>

        <!-- Submit Button (hidden, form auto-submits) -->
        <%= form.submit "Apply Filters", class: "hidden" %>
      <% end %>
    </div>
  </div>
<% end %>
