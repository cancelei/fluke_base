<% if contributions&.any? %>
  <div class="overflow-x-auto">
    <table class="table table-zebra">
      <thead>
        <tr>
          <th class="text-left text-xs font-medium text-base-content/60 uppercase tracking-wider">Contributor</th>
          <th class="text-center text-xs font-medium text-base-content/60 uppercase tracking-wider">Commits</th>
          <th class="text-center text-xs font-medium text-base-content/60 uppercase tracking-wider">Changes</th>
          <th class="text-center text-xs font-medium text-base-content/60 uppercase tracking-wider">Net</th>
        </tr>
      </thead>
      <tbody>
        <% contributions.each do |contribution| %>
          <%
            net_changes = (contribution[:total_added] || 0) - (contribution[:total_removed] || 0)
            net_class = net_changes.positive? ? "text-success" : net_changes.negative? ? "text-error" : "text-base-content/60"
            user = contribution[:user]
          %>
          <tr class="hover">
            <td class="whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <%= image_tag user.avatar_url.presence || "https://w7.pngwing.com/pngs/205/731/png-transparent-default-avatar-thumbnail.png",
                                class: "h-10 w-10 rounded-full",
                                alt: user.full_name,
                                onerror: "this.onerror=null; this.src='https://w7.pngwing.com/pngs/205/731/png-transparent-default-avatar-thumbnail.png'" %>
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-base-content">
                    <%= user.full_name %>
                    <% if user == project.user %>
                      <span class="badge badge-primary badge-sm ml-2">
                        Owner
                      </span>
                    <% end %>
                  </div>
                  <% if user.github_username.present? %>
                    <div class="text-sm text-base-content/60 flex items-center">
                      <svg class="h-4 w-4 mr-1 text-base-content/50" fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.1-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
                      </svg>
                      <%= link_to user.github_username,
                                  "https://github.com/#{user.github_username}",
                                  target: "_blank",
                                  class: "link link-primary" %>
                    </div>
                  <% end %>
                </div>
              </div>
            </td>
            <td class="whitespace-nowrap text-center">
              <span class="badge badge-info">
                <%= number_with_delimiter(contribution[:commit_count] || 0) %>
              </span>
            </td>
            <td class="whitespace-nowrap">
              <div class="flex items-center justify-center space-x-4">
                <div class="text-sm text-success font-medium">
                  +<%= number_with_delimiter(contribution[:total_added] || 0) %>
                </div>
                <div class="text-sm text-error font-medium">
                  -<%= number_with_delimiter(contribution[:total_removed] || 0) %>
                </div>
              </div>
            </td>
            <td class="whitespace-nowrap text-center">
              <span class="text-sm font-medium <%= net_class %>">
                <%= number_with_delimiter(net_changes) %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="px-6 py-12 text-center">
    <div class="animate-pulse">
      <div class="mx-auto h-12 w-12 bg-base-300 rounded-full"></div>
      <h3 class="mt-2 text-sm font-medium text-base-content">Loading contributions...</h3>
      <p class="mt-1 text-sm text-base-content/60">Analyzing repository data</p>
    </div>
  </div>
<% end %>
