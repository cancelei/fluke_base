<!-- app/views/admin/solid_queue_jobs/show.html.erb -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
      <h1 class="card-title text-2xl">Job Details</h1>
      <p class="text-sm text-base-content/70">Detailed information for background job #<%= @job.id %></p>
    </div>
  </div>

  <!-- Job Information -->
  <div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
      <div class="space-y-4">
        <div class="flex items-center border-b border-base-300 pb-4">
          <div class="w-40 font-semibold text-base-content">ID:</div>
          <div class="flex-1 font-mono text-sm"><%= @job.id %></div>
        </div>

        <div class="flex items-center border-b border-base-300 pb-4">
          <div class="w-40 font-semibold text-base-content">Queue:</div>
          <div class="flex-1"><%= @job.queue_name %></div>
        </div>

        <div class="flex items-center border-b border-base-300 pb-4">
          <div class="w-40 font-semibold text-base-content">Priority:</div>
          <div class="flex-1">
            <% case @job.priority
               when 0 %>
                <span class="badge badge-ghost">Normal</span>
            <% when 1 %>
                <span class="badge badge-error">High</span>
            <% when 2 %>
                <span class="badge badge-warning">Medium</span>
            <% when 3 %>
                <span class="badge badge-info">Low</span>
            <% end %>
          </div>
        </div>

        <div class="flex items-center border-b border-base-300 pb-4">
          <div class="w-40 font-semibold text-base-content">Job Class:</div>
          <div class="flex-1 font-mono text-xs"><%= @job.class_name %></div>
        </div>

        <div class="flex items-center border-b border-base-300 pb-4">
          <div class="w-40 font-semibold text-base-content">Status:</div>
          <div class="flex-1">
            <% if @job.finished_at %>
              <span class="badge badge-success">Completed</span>
            <% elsif @job.arguments && @job.arguments['exception_executions'] && !@job.arguments['exception_executions'].empty? %>
              <span class="badge badge-error">Failed</span>
            <% else %>
              <span class="badge badge-info">Pending</span>
            <% end %>
          </div>
        </div>

        <div class="flex items-center border-b border-base-300 pb-4">
          <div class="w-40 font-semibold text-base-content">Scheduled At:</div>
          <div class="flex-1 text-sm"><%= @job.scheduled_at.strftime("%Y-%m-%d %H:%M:%S") %></div>
        </div>

        <div class="flex items-center <%= @job.arguments ? "border-b border-base-300 pb-4" : "" %>">
          <div class="w-40 font-semibold text-base-content">Created At:</div>
          <div class="flex-1 text-sm"><%= @job.created_at.strftime("%Y-%m-%d %H:%M:%S") %></div>
        </div>

        <% if @job.arguments %>
          <div class="flex items-start border-b border-base-300 pb-4">
            <div class="w-40 font-semibold text-base-content">Arguments:</div>
            <div class="flex-1">
              <div class="mockup-code">
                <pre class="text-xs"><code><%= JSON.pretty_generate(@job.arguments) %></code></pre>
              </div>
            </div>
          </div>
        <% end %>

        <% if @job.arguments && @job.arguments['exception_executions'] && !@job.arguments['exception_executions'].empty? %>
          <div class="flex items-start">
            <div class="w-40 font-semibold text-base-content">Exception Details:</div>
            <div class="flex-1 space-y-4">
              <% @job.arguments["exception_executions"].each do |exception| %>
                <div class="alert alert-error">
                  <div>
                    <div class="font-bold"><%= exception["message"] %></div>
                    <div class="mt-2">
                      <div class="mockup-code">
                        <pre class="text-xs"><code><%= exception["backtrace"].join("\n") %></code></pre>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex gap-2">
    <%= link_to "Back to Jobs", admin_solid_queue_jobs_path, class: "btn btn-ghost" %>
    <%= link_to "Delete", admin_solid_queue_job_path(@job),
               method: :delete,
               data: { confirm: "Are you sure you want to delete this job?" },
               class: "btn btn-error" %>
  </div>
</div>
