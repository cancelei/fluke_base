<% if Rails.env.development? %>
  <div class="text-sm text-blue-600 bg-blue-50 p-3 rounded-md">
    🔧 Development Mode: Turnstile verification is disabled for easier testing.
  </div>
  <!-- Add hidden field for development mode -->
  <input type="hidden" name="turnstile_token" value="development_mode_token">
<% elsif Rails.application.config.turnstile[:site_key].present? %>
  <div class="text-sm text-green-600 bg-green-50 p-3 rounded-md">
    🛡️ Security verification enabled
  </div>

  <!-- Load Turnstile script with CSP compatibility -->
  <%= javascript_include_tag "https://challenges.cloudflare.com/turnstile/v0/api.js",
      async: true,
      defer: true,
      nonce: content_security_policy_nonce %>

  <!-- Turnstile widget with Stimulus controller (CSP-compliant) -->
  <div data-controller="turnstile"
       data-turnstile-sitekey-value="<%= Rails.application.config.turnstile[:site_key] %>"
       data-turnstile-size-value="invisible">
    <div data-turnstile-target="widget"></div>
  </div>
<% else %>
  <div class="text-sm text-yellow-600 bg-yellow-50 p-3 rounded-md">
    ⚠️ Turnstile is not configured. Please set TURNSTILE_SITE_KEY environment variable.
  </div>
<% end %>
