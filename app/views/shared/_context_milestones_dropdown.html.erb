<%# Context Navigation Milestones Dropdown %>
<%# Displays milestone selection and time tracking controls in the context navigation bar %>
<%# IMPORTANT: This partial contains a div with id="context_milestones_list" %>
<%# For Turbo Stream updates, use _context_milestones_list.html.erb partial instead %>
<%# See: docs/guides/frontend/turbo-patterns.md - "Nested Frame Content Anti-Pattern" %>

<% return unless selected_project.present? %>

<% milestones = selected_project.milestones %>
<% active_milestones = milestones.reject(&:completed?) %>

<details class="dropdown dropdown-end" data-context-nav-target="milestoneDropdown">
  <summary class="btn btn-ghost btn-sm gap-2">
    <svg class="w-4 h-4 text-base-content/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
    </svg>
    <span>Milestones</span>
    <% if active_milestones.any? %>
      <span class="badge badge-primary badge-xs"><%= active_milestones.count %></span>
    <% end %>
    <svg class="w-4 h-4 text-base-content/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </summary>

  <div class="dropdown-content z-[60] card card-compact shadow-xl bg-base-100 w-80 border border-base-200">
    <div class="card-body p-0">
      <div class="px-4 py-3 border-b border-base-200">
        <h3 class="font-semibold text-sm">Project Milestones</h3>
        <p class="text-xs text-base-content/60 mt-0.5">Track time on your milestones</p>
      </div>

      <%# This div is updated via Turbo Stream - use _context_milestones_list partial %>
      <div id="context_milestones_list" class="max-h-72 overflow-y-auto">
        <%= render "shared/context_milestones_list",
                   selected_project: selected_project,
                   current_user: current_user %>
      </div>

      <% if active_milestones.any? %>
        <div class="px-4 py-2 border-t border-base-200 bg-base-200/30">
          <%= link_to project_milestones_path(selected_project),
              class: "text-xs text-primary hover:underline",
              data: { turbo_frame: "_top" } do %>
            View all milestones (<%= milestones.count %>)
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</details>
