<% if current_user.selected_project_id.present? %>
  <% selected_project = Project.find(current_user.selected_project_id) %>
  <% milestones = current_user.id == selected_project.user_id ? selected_project.milestones : Milestone.where(id: selected_project.agreements.joins(:agreement_participants).where(agreement_participants: { user_id: current_user.id }).active.pluck(:milestone_ids).flatten) %>

  <% milestones.filter { |m| !m.completed? }.each do |milestone| %>
    <% active_log = selected_project.time_logs.in_progress.find_by(milestone_id: milestone.id, user_id: current_user.id) %>
    <div class="flex items-center justify-between px-4 py-3 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 transition-all duration-200">
      <div class="flex items-center space-x-3">
        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
        <span class="text-sm font-medium text-gray-700"><%= milestone.title %></span>
      </div>
      <% if active_log %>
        <%= button_to stop_tracking_time_logs_path(selected_project, milestone_id: milestone.id), method: :post, class: "inline-flex items-center px-2 py-1 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-colors", form: { data: { turbo: true } } do %>
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
            <rect x="6" y="6" width="12" height="12" rx="2" />
          </svg>
        <% end %>
      <% else %>
        <%= button_to time_logs_path(selected_project, milestone_id: milestone.id), method: :post, class: "inline-flex items-center px-2 py-1 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 transition-colors", form: { data: { turbo: true } } do %>
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
            <polygon points="5,3 19,12 5,21" />
          </svg>
        <% end %>
      <% end %>
    </div>
  <% end %>
<% end %>
