<% if current_user.selected_project_id.present? %>
  <% selected_project = Project.find(current_user.selected_project_id) %>
  <% milestones = selected_project.milestones %>
  <% active_milestones = milestones.filter { |m| !m.completed? } %>

  <% if active_milestones.any? %>
    <% active_milestones.each do |milestone| %>
    <% active_log = selected_project.time_logs.in_progress.find_by(milestone_id: milestone.id, user_id: current_user.id) %>
    <div class="flex items-center justify-between px-4 py-3 hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 transition-all duration-200">
      <div class="flex items-center space-x-3">
        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
        <span class="text-sm font-medium text-gray-700"><%= milestone.title %></span>
      </div>
      <% if active_log %>
        <%= button_to stop_tracking_time_logs_path(selected_project, milestone_id: milestone.id), method: :post, class: "inline-flex items-center px-2 py-1 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 transition-colors", form: { data: { turbo: true } } do %>
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
            <rect x="6" y="6" width="12" height="12" rx="2" />
          </svg>
        <% end %>
      <% else %>
        <%= button_to time_logs_path(selected_project, milestone_id: milestone.id), method: :post, class: "inline-flex items-center px-2 py-1 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 transition-colors", form: { data: { turbo: true } } do %>
          <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
            <polygon points="5,3 19,12 5,21" />
          </svg>
        <% end %>
      <% end %>
    </div>
    <% end %>
  <% else %>
    <!-- No active milestones -->
    <div class="px-4 py-3 text-sm text-gray-500 text-center">
      <p>No active milestones</p>
      <% if selected_project.present? %>
        <%= link_to "Create milestone", new_project_milestone_path(selected_project),
            class: "mt-2 inline-flex items-center px-3 py-1.5 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-all duration-200" %>
      <% end %>
    </div>
  <% end %>
<% end %>
