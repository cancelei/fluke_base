<%= turbo_frame_tag "#{dom_id(@agreement || meeting.agreement)}_meeting_form" do %>
  <div class="card bg-base-100 shadow-lg">
    <div class="card-body">
      <div class="flex justify-between items-center mb-4">
        <h3 class="card-title">
          <%= meeting.persisted? ? "Edit Meeting" : "Schedule New Meeting" %>
        </h3>
        <%= link_to "Cancel", agreement_path(@agreement || meeting.agreement),
            class: "btn btn-ghost btn-sm",
            data: { turbo_frame: "_top" } %>
      </div>

      <!-- Steps Component for Meeting Scheduling Flow -->
      <% unless meeting.persisted? %>
        <ul class="steps steps-vertical lg:steps-horizontal w-full mb-6">
          <li class="step step-primary">
            <div class="text-xs font-medium">Meeting Details</div>
          </li>
          <li class="step">
            <div class="text-xs font-medium">Date & Time</div>
          </li>
          <li class="step">
            <div class="text-xs font-medium">Confirm & Schedule</div>
          </li>
        </ul>
      <% end %>

      <%= fluke_form_with(model: [ @agreement || meeting.agreement, meeting ], class: "space-y-6") do |form| %>
        <% if meeting.errors.any? %>
          <%= ui_alert(variant: :error, css_class: "mb-6") do %>
            <div>
              <h3 class="font-bold">There <%= meeting.errors.count == 1 ? "is" : "are" %> <%= pluralize(meeting.errors.count, "error") %> with this meeting:</h3>
              <ul class="list-disc list-inside mt-2">
                <% meeting.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>
        <% end %>

        <div class="space-y-6">
          <fieldset class="fieldset">
            <%= form.label :title, class: "fieldset-legend" %>
            <%= form.text_field :title, class: "input w-full" %>
          </fieldset>

          <fieldset class="fieldset">
            <%= form.label :description, class: "fieldset-legend" %>
            <%= form.text_area :description, rows: 3, class: "textarea w-full" %>
          </fieldset>

          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <fieldset class="fieldset">
              <%= form.label :start_time, class: "fieldset-legend" %>
              <%= form.datetime_local_field :start_time, class: "input w-full" %>
            </fieldset>

            <fieldset class="fieldset">
              <%= form.label :end_time, class: "fieldset-legend" %>
              <%= form.datetime_local_field :end_time, class: "input w-full" %>
            </fieldset>
          </div>

          <%= ui_alert(variant: :info) do %>
            <span>
              <strong>Note:</strong> This meeting will be scheduled between
              <% presenter = present(@agreement || meeting.agreement) %>
              <%= presenter.parties_display %>.
            </span>
          <% end %>

          <div class="card-actions justify-end">
            <%= link_to "Cancel", agreement_path(@agreement || meeting.agreement),
                class: "btn btn-ghost",
                data: { turbo_frame: "_top" } %>
            <%= form.submit_button meeting.persisted? ? "Update Meeting" : "Schedule Meeting" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
