<% other_user = conversation.other_user(current_user) %>
<li id="conversation_<%= conversation.id %>_item" class="w-full p-1">
  <%= link_to conversation_path(conversation),
        class: "flex w-full items-center gap-3 p-3 rounded-lg transition-colors #{current_conversation == conversation ? 'bg-primary/10 text-primary' : 'hover:bg-base-200'}",
        onclick: "document.getElementById('mobile-conversation-sidebar')?.classList.add('hidden')",
        data: {
          turbo_stream: true
        } do %>
    <!-- Avatar -->
    <div class="avatar <%= "online" if other_user.respond_to?(:online?) && other_user.online? %> placeholder">
      <div class="<%= current_conversation == conversation ? "bg-primary text-primary-content" : "bg-base-200" %> rounded-full w-12 h-12 flex items-center justify-center">
        <% if other_user.avatar.attached? %>
          <%= image_tag other_user.avatar, class: "rounded-full w-full h-full object-cover" %>
        <% else %>
          <span class="text-sm font-medium"><%= other_user.initials %></span>
        <% end %>
      </div>
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0">
      <div class="flex items-center justify-between">
        <p class="font-medium truncate"><%= other_user.full_name %></p>
        <% if conversation.last_message.present? %>
          <span class="text-xs text-base-content/60 whitespace-nowrap ml-2">
            <%= time_ago_in_words(conversation.last_message.created_at) %>
          </span>
        <% end %>
      </div>
      <% if conversation.last_message.present? %>
        <p class="text-sm text-base-content/70 truncate">
          <%= conversation.last_message.body.truncate(40) %>
        </p>
      <% end %>
    </div>

    <!-- Unread indicator -->
    <% if conversation.unread_messages_for?(current_user) %>
      <span class="badge badge-primary badge-sm"></span>
    <% end %>
  <% end %>
</li>
