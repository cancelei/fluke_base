#!/usr/bin/env bash

# Test script for GitHub Actions workflows
# This simulates the GitHub Actions environment locally

echo "ğŸ§ª Testing GitHub Actions Workflow Locally"
echo "=========================================="

# Check if we're in a git repository
if [ ! -d ".git" ]; then
    echo "âŒ Not in a git repository. Please run from the project root."
    exit 1
fi

# Check if required tools are installed
echo "ğŸ” Checking dependencies..."

if ! command -v ruby &> /dev/null; then
    echo "âŒ Ruby is not installed"
    exit 1
fi

if ! command -v node &> /dev/null; then
    echo "âŒ Node.js is not installed"
    exit 1
fi

if ! command -v bundle &> /dev/null; then
    echo "âŒ Bundler is not installed"
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "âŒ npm is not installed"
    exit 1
fi

echo "âœ… All dependencies found"

# Install dependencies
echo "ğŸ“¦ Installing dependencies..."
bundle install --jobs 4 --retry 3
npm ci

# Run the unified linter
echo "ğŸ” Running unified linter..."
./bin/lint

# Check exit code
if [ $? -eq 0 ]; then
    echo "âœ… All tests passed! Ready for GitHub Actions."
else
    echo "âŒ Some tests failed. Please fix issues before pushing."
    exit 1
fi

echo "ğŸš€ Ready to push to GitHub!"
